<!doctype html><html lang=zh-cn><head><title>使用 Carthage 做依赖管理 // 风行's Blog</title><meta charset=utf-8><meta name=generator content="Hugo 0.61.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="风行"><meta name=description content><link rel=stylesheet href=https://lijingcheng.github.io/css/main.min.61bb32028587f24ca28522d8d197970c7ef33284e5fffb45a75fcbbb2dbc4dcb.css><meta name=twitter:card content="summary"><meta name=twitter:title content="使用 Carthage 做依赖管理"><meta name=twitter:description content="Carthage 会在帮你下载完第三方依赖库后，通过 xcodebuild 将其编译成动态库，但它不会像 CocoaPods 那样去修改你的项目文件和编译设置，这些都需要你自己去完成。
Carthage VS CocoaPods   CocoaPods 需要我们在本地维护第三方库依赖的 podspec 文件，大部分 pod 命令执行时都会去读取此文件，Carthage 则是去中心化的管理方式，不需要维护这种说明文件，它会去直接下载项目并编译成动态库使用，所以对使用 Carthage 的项目来说，最低系统适配要求 iOS8+
  CocoaPods 在执行 pod install 后会帮我们做好所有配置工作，我们只需要用它提供的 workspace 文件打开项目即可，使用 Carthage 的话需要我们自己到项目中进行动态库以及打包资源的配置，但是好处是项目配置信息相对 CocoaPods 来说较干净
  Carthage 使用的是动态库方式，所以无法进行调试，看不到源码，但带来的好处是编译速度的提高
  Carthage 的下载源目前仅支持 GitHub（GitHub.com 和 GitHub Enterprise），CocoaPods 除了 GitHub，还支持我们托管在公司的 Git 仓库，还有本地路径
  目前支持 CocoaPods 的第三方库比 Carthage 要多一些
  我们可以在一个项目里同时使用 CocoaPods 和 Carthage，可以用 Carthage 管理比较成熟并且不需要调试的第三方库，用来提高编译速度，再用 CocoaPods 管理其它有可能需要进行代码调试的第三方库，还可以用来在组件化开发中做依赖设置。
安装 Carthage 建议通过 HomeBrew 安装"><meta property="og:title" content="使用 Carthage 做依赖管理"><meta property="og:description" content="Carthage 会在帮你下载完第三方依赖库后，通过 xcodebuild 将其编译成动态库，但它不会像 CocoaPods 那样去修改你的项目文件和编译设置，这些都需要你自己去完成。
Carthage VS CocoaPods   CocoaPods 需要我们在本地维护第三方库依赖的 podspec 文件，大部分 pod 命令执行时都会去读取此文件，Carthage 则是去中心化的管理方式，不需要维护这种说明文件，它会去直接下载项目并编译成动态库使用，所以对使用 Carthage 的项目来说，最低系统适配要求 iOS8+
  CocoaPods 在执行 pod install 后会帮我们做好所有配置工作，我们只需要用它提供的 workspace 文件打开项目即可，使用 Carthage 的话需要我们自己到项目中进行动态库以及打包资源的配置，但是好处是项目配置信息相对 CocoaPods 来说较干净
  Carthage 使用的是动态库方式，所以无法进行调试，看不到源码，但带来的好处是编译速度的提高
  Carthage 的下载源目前仅支持 GitHub（GitHub.com 和 GitHub Enterprise），CocoaPods 除了 GitHub，还支持我们托管在公司的 Git 仓库，还有本地路径
  目前支持 CocoaPods 的第三方库比 Carthage 要多一些
  我们可以在一个项目里同时使用 CocoaPods 和 Carthage，可以用 Carthage 管理比较成熟并且不需要调试的第三方库，用来提高编译速度，再用 CocoaPods 管理其它有可能需要进行代码调试的第三方库，还可以用来在组件化开发中做依赖设置。
安装 Carthage 建议通过 HomeBrew 安装"><meta property="og:type" content="article"><meta property="og:url" content="https://lijingcheng.github.io/posts/carthage/"><meta property="article:published_time" content="2016-12-23T19:18:47+08:00"><meta property="article:modified_time" content="2016-12-23T19:18:47+08:00"></head><body><header class=app-header><a href=https://lijingcheng.github.io><img class=app-header-avatar src=/images/avatar.png alt=风行></a><h1>风行's Blog</h1><p>一直在学习的大龄程序员</p><div class=app-header-social><a target=_blank href=https://github.com/lijingcheng rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://www.instagram.com/bj_lijingcheng/ rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-instagram"><title>instagram</title><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>使用 Carthage 做依赖管理</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Dec 23, 2016</div></div></header><div class=post-content><p><a href=https://github.com/Carthage/Carthage>Carthage</a> 会在帮你下载完第三方依赖库后，通过 xcodebuild 将其编译成动态库，但它不会像 CocoaPods 那样去修改你的项目文件和编译设置，这些都需要你自己去完成。</p><h1 id=carthage-vs-cocoapods>Carthage VS CocoaPods</h1><ul><li><p>CocoaPods 需要我们在本地维护第三方库依赖的 podspec 文件，大部分 pod 命令执行时都会去读取此文件，Carthage 则是去中心化的管理方式，不需要维护这种说明文件，它会去直接下载项目并编译成动态库使用，所以对使用 Carthage 的项目来说，最低系统适配要求 iOS8+</p></li><li><p>CocoaPods 在执行 pod install 后会帮我们做好所有配置工作，我们只需要用它提供的 workspace 文件打开项目即可，使用 Carthage 的话需要我们自己到项目中进行动态库以及打包资源的配置，但是好处是项目配置信息相对 CocoaPods 来说较干净</p></li><li><p>Carthage 使用的是动态库方式，所以无法进行调试，看不到源码，但带来的好处是编译速度的提高</p></li><li><p>Carthage 的下载源目前仅支持 GitHub（GitHub.com 和 GitHub Enterprise），CocoaPods 除了 GitHub，还支持我们托管在公司的 Git 仓库，还有本地路径</p></li><li><p>目前支持 CocoaPods 的第三方库比 Carthage 要多一些</p></li></ul><p>我们可以在一个项目里同时使用 CocoaPods 和 Carthage，可以用 Carthage 管理比较成熟并且不需要调试的第三方库，用来提高编译速度，再用 CocoaPods 管理其它有可能需要进行代码调试的第三方库，还可以用来在组件化开发中做依赖设置。</p><h1 id=-carthage>安装 Carthage</h1><p>建议通过 HomeBrew 安装</p><pre><code>brew install carthage
</code></pre><h1 id=-carthage-1>使用 Carthage</h1><p>在项目目录下创建 <a href=https://github.com/Carthage/Carthage/blob/master/Documentation/Artifacts.md>Cartfile</a> 文件，并写入想要使用的第三方库</p><pre><code>github &quot;lijingcheng/FMDBHelper&quot; == 1.0.0
</code></pre><ul><li>获取/更新 第三方库</li></ul><pre><code>carthage update --platform iOS
</code></pre><p>执行完成后，本地目录下会新增以下文件及目录</p><ul><li>Cartfile.resolved 作用同 CocoaPods 中的 Podfile.lock 文件，用来跟踪项目当前使用的第三方库版本，此文件需要提交到 Git</li><li>Carthage/Checkouts 第三方库的项目代码会存放在这里</li><li>Carthage/Build 用于存储根据第三方库的项目代码打包后的动态库以及 .dSYM 文件</li></ul><p>将动态库添加到项目中</p><pre><code>Target -&gt; General -&gt; Embedded Binaries
</code></pre><p>将资源文件添加到项目中</p><pre><code>Target -&gt; Build Phases -&gt; Copy Bundle Resources
</code></pre><p>针对由 universal binaries 引起的 App Store submission bug，还需要添加角本 <code>copy-frameworks</code></p><p>为了根踪第三方库的 Crash 信息，还需要将 .dSYM 文件添加到 <code>Copy Files Phase</code></p><p>导入第三方库</p><pre><code>#import &lt;FMDBHelper/FMDBHelper.h&gt;
</code></pre><p>完成了上述步骤并提交后，其他开发人员只需要用 carthage boostrap 来将第三方库下载到本地就可以了，以后还可以通过 carthage outdated 来检查依赖的第三方库是否有更新。</p><h1 id=carthage-boostrap-vs-carthage-update>carthage boostrap VS carthage update</h1><ul><li>carthage update 会去读 Cartfile 文件，如果添加了新的第三方库，或更新了版本号，则需要用这个命令去下载更新，执行完成后 Cartfile.resolved 文件也会同步更新</li><li>carthage boostrap 会去读 Cartfile.resolved 文件，并根据指定版本号进行下载，所以如果只是为了下载则可以使用这个命令</li></ul><h1 id=-carthage-2>让自己的开源项目支持 Carthage</h1><p>Carthage 仅支持动态库，所以你的开源项目也只能支持 iOS8 及以上版本</p><ul><li><p>Carthage 提供给用户的动态库是根据项目中的 <code>动态库 Target</code> 编译打包后生成的，所以首先我们需要新建一个 Target，选择 Cocoa Touch Framework（动态库），并设置 Deployment Target</p></li><li><p>添加 .h 文件到 Build Phases -> Headers -> Public</p></li><li><p>添加 .m 文件到 Build Phases -> Compile Sources</p></li><li><p>添加其它资源文件到 Build Phases -> Copy Bundle Sources</p></li><li><p>Carthage 只构建从 .xcodeproj 分享出来的 scheme，所以需要我们在 Manage Schemes 中将新生成的 scheme 设置为 shared</p></li><li><p>通过 <code>carthage build --no-skip-current</code> 来检测 scheme 是否能够构建成功，然后检查 Carthage/Build 目录</p></li><li><p>Carthage 通过搜索 Git tag 来决定用户可以下载哪个版本的项目资源，所以还需要在提交代码后添加 tag 并 push 到 GitHub，格式建议写成 1.2.0 或 v1.2</p></li><li><p>通过在 Readme.md 中添加下面内容，用来在 github 上项目介绍中显示 <img src="https://img.shields.io/badge/Carthage-compatible-4BC51D.svg?style=flat" alt="Carthage compatible"></p></li></ul><pre><code>[![Carthage compatible](https://img.shields.io/badge/Carthage-compatible-4BC51D.svg?style=flat)]()
</code></pre></div><div class=post-footer></div></article></main></body></html>