<!doctype html><html lang=zh-cn><head><title>iOS 应用的启动任务设计 // 风行's Blog</title><meta charset=utf-8><meta name=generator content="Hugo 0.61.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="风行"><meta name=description content><link rel=stylesheet href=https://lijingcheng.github.io/css/main.min.61bb32028587f24ca28522d8d197970c7ef33284e5fffb45a75fcbbb2dbc4dcb.css><meta name=twitter:card content="summary"><meta name=twitter:title content="iOS 应用的启动任务设计"><meta name=twitter:description content="从点击 app 图标到看到首页内容就算是一次启动过程，在这个短则一两秒的过程中 app 要做的事情却有很多，本文主要介绍如何管理这些任务的执行方式和优先级问题。
下面列出 app 启动过程中会去执行的一些主要任务：
  设置 app UI 样式
  开启定位、埋点、网络状态监听、通知监听等服务
  初始化一些第三方服务
  如果是通过点击推送通知进入的 app 还会去存储相关数据用于在进入首页后跳转页面或弹框
  访问一些接口并处理返回结果
  上面列出的大部分任务都不需要我们主动去管理，只要在处理过程中注意不要影响启动速度就可以了，需要我们去管理的任务主要是对于一些接口返回数据的处理，像 升级检查、换肤、弹窗广告 这类接口在拿到返回数据后不能够马上处理，而是需要先保存数据然后等待首页展示出来后再做 UI 效果处理，并且这些任务通常还需要考虑优先级问题，例如当需要展示升级提示时就不应该再展示弹窗广告。
我目前的处理方案是基于 RxSwift 响应式编程框架实现，每项任务都是可以被订阅的，订阅者可以监听任务状态并作出响应，每项任务的最初状态是 unknown 未知的，也就是接口还未返回数据时的状态，当接口返回数据后，再根据情况将状态改为 need 或 noneed，也就是需要处理或不需要处理，我们可以让接口调用处只将关注点放在改变任务状态上，不同状态时该如何处理是由该任务的管理类决定，具体什么时候以及是否需要处理则是由该任务的订阅者去决定。
下面以 检查升级 任务为主线看下具体代码实现，首先在 app 启动后发起异步接口调用，并根据返回数据修改任务状态，此时不用考虑 app 是否已经进入首页，以及如果弹框提示用户等功能
NetworkService.get(&#34;xxx.api&#34;) { [weak self] (result, error) in if ... { Task.shared.upgrade.accept(.need) } else { Task.shared.upgrade.accept(.noneed) } } 当 app 进入首页后，会在 viewDidAppear 方法中发出 Notification 用来触发任务订阅管理功能"><meta property="og:title" content="iOS 应用的启动任务设计"><meta property="og:description" content="从点击 app 图标到看到首页内容就算是一次启动过程，在这个短则一两秒的过程中 app 要做的事情却有很多，本文主要介绍如何管理这些任务的执行方式和优先级问题。
下面列出 app 启动过程中会去执行的一些主要任务：
  设置 app UI 样式
  开启定位、埋点、网络状态监听、通知监听等服务
  初始化一些第三方服务
  如果是通过点击推送通知进入的 app 还会去存储相关数据用于在进入首页后跳转页面或弹框
  访问一些接口并处理返回结果
  上面列出的大部分任务都不需要我们主动去管理，只要在处理过程中注意不要影响启动速度就可以了，需要我们去管理的任务主要是对于一些接口返回数据的处理，像 升级检查、换肤、弹窗广告 这类接口在拿到返回数据后不能够马上处理，而是需要先保存数据然后等待首页展示出来后再做 UI 效果处理，并且这些任务通常还需要考虑优先级问题，例如当需要展示升级提示时就不应该再展示弹窗广告。
我目前的处理方案是基于 RxSwift 响应式编程框架实现，每项任务都是可以被订阅的，订阅者可以监听任务状态并作出响应，每项任务的最初状态是 unknown 未知的，也就是接口还未返回数据时的状态，当接口返回数据后，再根据情况将状态改为 need 或 noneed，也就是需要处理或不需要处理，我们可以让接口调用处只将关注点放在改变任务状态上，不同状态时该如何处理是由该任务的管理类决定，具体什么时候以及是否需要处理则是由该任务的订阅者去决定。
下面以 检查升级 任务为主线看下具体代码实现，首先在 app 启动后发起异步接口调用，并根据返回数据修改任务状态，此时不用考虑 app 是否已经进入首页，以及如果弹框提示用户等功能
NetworkService.get(&#34;xxx.api&#34;) { [weak self] (result, error) in if ... { Task.shared.upgrade.accept(.need) } else { Task.shared.upgrade.accept(.noneed) } } 当 app 进入首页后，会在 viewDidAppear 方法中发出 Notification 用来触发任务订阅管理功能"><meta property="og:type" content="article"><meta property="og:url" content="https://lijingcheng.github.io/posts/ios-task/"><meta property="article:published_time" content="2019-08-29T15:18:55+08:00"><meta property="article:modified_time" content="2019-08-29T15:18:55+08:00"></head><body><header class=app-header><a href=https://lijingcheng.github.io><img class=app-header-avatar src=/images/avatar.png alt=风行></a><h1>风行's Blog</h1><p>Do not repeat yourself!</p><div class=app-header-social><a target=_blank href=https://github.com/lijingcheng rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://www.instagram.com/bj_lijingcheng/ rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-instagram"><title>instagram</title><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>iOS 应用的启动任务设计</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Aug 29, 2019</div></div></header><div class=post-content><p>从点击 app 图标到看到首页内容就算是一次启动过程，在这个短则一两秒的过程中 app 要做的事情却有很多，本文主要介绍如何管理这些任务的执行方式和优先级问题。</p><p>下面列出 app 启动过程中会去执行的一些主要任务：</p><ul><li><p>设置 app UI 样式</p></li><li><p>开启定位、埋点、网络状态监听、通知监听等服务</p></li><li><p>初始化一些第三方服务</p></li><li><p>如果是通过点击推送通知进入的 app 还会去存储相关数据用于在进入首页后跳转页面或弹框</p></li><li><p>访问一些接口并处理返回结果</p></li></ul><p>上面列出的大部分任务都不需要我们主动去管理，只要在处理过程中注意不要影响启动速度就可以了，需要我们去管理的任务主要是对于一些接口返回数据的处理，像 <code>升级检查</code>、<code>换肤</code>、<code>弹窗广告</code> 这类接口在拿到返回数据后不能够马上处理，而是需要先保存数据然后等待首页展示出来后再做 UI 效果处理，并且这些任务通常还需要考虑优先级问题，例如当需要展示升级提示时就不应该再展示弹窗广告。</p><p>我目前的处理方案是基于 RxSwift 响应式编程框架实现，每项任务都是可以被订阅的，订阅者可以监听任务状态并作出响应，每项任务的最初状态是 <code>unknown</code> 未知的，也就是接口还未返回数据时的状态，当接口返回数据后，再根据情况将状态改为 <code>need</code> 或 <code>noneed</code>，也就是需要处理或不需要处理，我们可以让接口调用处只将关注点放在改变任务状态上，不同状态时该如何处理是由该任务的管理类决定，具体什么时候以及是否需要处理则是由该任务的订阅者去决定。</p><p>下面以 <code>检查升级</code> 任务为主线看下具体代码实现，首先在 app 启动后发起异步接口调用，并根据返回数据修改任务状态，此时不用考虑 app 是否已经进入首页，以及如果弹框提示用户等功能</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift>NetworkService.<span style=color:#66d9ef>get</span>(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>xxx.api</span><span style=color:#e6db74>&#34;</span>) { [<span style=color:#66d9ef>weak</span> <span style=color:#66d9ef>self</span>] (result, error) <span style=color:#66d9ef>in</span>
    <span style=color:#66d9ef>if</span> ... {
        Task.shared.upgrade.accept(.need)
    } <span style=color:#66d9ef>else</span> {
        Task.shared.upgrade.accept(.noneed)
    }
}
</code></pre></div><p>当 app 进入首页后，会在 viewDidAppear 方法中发出 Notification 用来触发任务订阅管理功能</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift>NotificationCenter.<span style=color:#66d9ef>default</span>.rx.notification(Notification.Name.Event.appDidAppear).subscribe(onNext: { notification <span style=color:#66d9ef>in</span>
    Task.shared.subscribe()
}).disposed(by: disposeBag)
</code></pre></div><p>然后我们再来看下 Task 的具体实现，在下面例子中列出了七个需要处理的任务，其中<code>换肤</code>、<code>小红点</code>、<code>过期提醒</code>这三个任务是进入首页后就可以直接执行，不用考虑优先级问题，而<code>升级提示</code>、<code>切换城市</code>、<code>弹窗广告</code>、<code>推送跳转</code>这四个任务之间有优先级关系，需要特殊处理一下</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Task</span> {
    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>let</span> shared = Task()
    
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>init</span>() {
    }
    
    <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>Status</span>: Int {
        <span style=color:#66d9ef>case</span> unknown, need, noneed
    }
    
    <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>B</span><span style=color:#75715e>e</span><span style=color:#75715e>h</span><span style=color:#75715e>a</span><span style=color:#75715e>v</span><span style=color:#75715e>i</span><span style=color:#75715e>o</span><span style=color:#75715e>r</span><span style=color:#75715e>R</span><span style=color:#75715e>e</span><span style=color:#75715e>l</span><span style=color:#75715e>a</span><span style=color:#75715e>y</span><span style=color:#75715e> </span><span style=color:#75715e>类</span><span style=color:#75715e>型</span><span style=color:#75715e>的</span><span style=color:#75715e>任</span><span style=color:#75715e>务</span><span style=color:#75715e>在</span><span style=color:#75715e>被</span><span style=color:#75715e>订</span><span style=color:#75715e>阅</span><span style=color:#75715e>后</span><span style=color:#75715e>，</span><span style=color:#75715e>订</span><span style=color:#75715e>阅</span><span style=color:#75715e>者</span><span style=color:#75715e>会</span><span style=color:#75715e>先</span><span style=color:#75715e>收</span><span style=color:#75715e>到</span><span style=color:#75715e>最</span><span style=color:#75715e>近</span><span style=color:#75715e>一</span><span style=color:#75715e>次</span><span style=color:#75715e>的</span><span style=color:#75715e>事</span><span style=color:#75715e>件</span><span style=color:#75715e>或</span><span style=color:#75715e>初</span><span style=color:#75715e>始</span><span style=color:#75715e>事</span><span style=color:#75715e>件</span>
    <span style=color:#66d9ef>var</span> upgrade = BehaviorRelay(value: Status.unknown) <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>升</span><span style=color:#75715e>级</span><span style=color:#75715e>弹</span><span style=color:#75715e>框</span>
    <span style=color:#66d9ef>var</span> switchCity = BehaviorRelay(value: Status.unknown) <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>切</span><span style=color:#75715e>换</span><span style=color:#75715e>城</span><span style=color:#75715e>市</span><span style=color:#75715e>弹</span><span style=color:#75715e>框</span>
    <span style=color:#66d9ef>var</span> popAdvertise = BehaviorRelay(value: Status.unknown) <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>弹</span><span style=color:#75715e>窗</span><span style=color:#75715e>广</span><span style=color:#75715e>告</span>
    <span style=color:#66d9ef>var</span> apns = BehaviorRelay(value: Status.unknown) <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>推</span><span style=color:#75715e>送</span><span style=color:#75715e>跳</span><span style=color:#75715e>转</span>
    <span style=color:#66d9ef>var</span> skin = BehaviorRelay(value: Status.unknown) <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>换</span><span style=color:#75715e>肤</span>
    <span style=color:#66d9ef>var</span> trackPoint = BehaviorRelay(value: Status.unknown) <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>用</span><span style=color:#75715e>于</span><span style=color:#75715e> </span><span style=color:#75715e>t</span><span style=color:#75715e>a</span><span style=color:#75715e>b</span><span style=color:#75715e>B</span><span style=color:#75715e>a</span><span style=color:#75715e>r</span><span style=color:#75715e>I</span><span style=color:#75715e>t</span><span style=color:#75715e>e</span><span style=color:#75715e>m</span><span style=color:#75715e> </span><span style=color:#75715e>等</span><span style=color:#75715e>地</span><span style=color:#75715e>方</span><span style=color:#75715e>的</span><span style=color:#75715e>小</span><span style=color:#75715e>红</span><span style=color:#75715e>点</span><span style=color:#75715e>提</span><span style=color:#75715e>醒</span>
    <span style=color:#66d9ef>var</span> remind = BehaviorRelay(value: Status.unknown) <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>以</span><span style=color:#75715e>气</span><span style=color:#75715e>泡</span><span style=color:#75715e>视</span><span style=color:#75715e>图</span><span style=color:#75715e>形</span><span style=color:#75715e>式</span><span style=color:#75715e>展</span><span style=color:#75715e>示</span><span style=color:#75715e>的</span><span style=color:#75715e>过</span><span style=color:#75715e>期</span><span style=color:#75715e>提</span><span style=color:#75715e>醒</span>
    
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>let</span> disposeBag = DisposeBag()
    
    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>subscribe</span>() {
        <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>升</span><span style=color:#75715e>级</span><span style=color:#75715e>弹</span><span style=color:#75715e>框</span><span style=color:#75715e>的</span><span style=color:#75715e>优</span><span style=color:#75715e>先</span><span style=color:#75715e>级</span><span style=color:#75715e>最</span><span style=color:#75715e>高</span><span style=color:#75715e>，</span><span style=color:#75715e>不</span><span style=color:#75715e>管</span><span style=color:#75715e>当</span><span style=color:#75715e>前</span><span style=color:#75715e>在</span><span style=color:#75715e>干</span><span style=color:#75715e>什</span><span style=color:#75715e>么</span><span style=color:#75715e>都</span><span style=color:#75715e>会</span><span style=color:#75715e>直</span><span style=color:#75715e>接</span><span style=color:#75715e>弹</span><span style=color:#75715e>框</span>
        upgrade.subscribe(onNext: { status <span style=color:#66d9ef>in</span>
            <span style=color:#66d9ef>if</span> status == .need {
                NotificationCenter.<span style=color:#66d9ef>default</span>.post(name: NSNotification.Name.Event.hidePopAdvertise, object: <span style=color:#66d9ef>nil</span>)
                <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>取</span><span style=color:#75715e>消</span><span style=color:#75715e>切</span><span style=color:#75715e>换</span><span style=color:#75715e>城</span><span style=color:#75715e>市</span><span style=color:#75715e>等</span><span style=color:#75715e>弹</span><span style=color:#75715e>框</span><span style=color:#75715e>，</span><span style=color:#75715e>显</span><span style=color:#75715e>示</span><span style=color:#75715e>升</span><span style=color:#75715e>级</span><span style=color:#75715e>提</span><span style=color:#75715e>示</span><span style=color:#75715e>弹</span><span style=color:#75715e>框</span>
            }
        }).disposed(by: disposeBag)
        
        <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>切</span><span style=color:#75715e>换</span><span style=color:#75715e>城</span><span style=color:#75715e>市</span><span style=color:#75715e>弹</span><span style=color:#75715e>框</span><span style=color:#75715e>优</span><span style=color:#75715e>先</span><span style=color:#75715e>级</span><span style=color:#75715e>仅</span><span style=color:#75715e>次</span><span style=color:#75715e>于</span><span style=color:#75715e>升</span><span style=color:#75715e>级</span><span style=color:#75715e>提</span><span style=color:#75715e>示</span>
        switchCity.subscribe(onNext: { status <span style=color:#66d9ef>in</span>
            <span style=color:#66d9ef>guard</span> <span style=color:#66d9ef>self</span>.upgrade.value <span style=color:#f92672>!=</span> .need <span style=color:#66d9ef>else</span> {
                <span style=color:#66d9ef>return</span>
            }
            
            <span style=color:#66d9ef>if</span> status == .need {
                NotificationCenter.<span style=color:#66d9ef>default</span>.post(name: NSNotification.Name.Event.hidePopAdvertise, object: <span style=color:#66d9ef>nil</span>)
                <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>显</span><span style=color:#75715e>示</span><span style=color:#75715e>切</span><span style=color:#75715e>换</span><span style=color:#75715e>城</span><span style=color:#75715e>市</span><span style=color:#75715e>弹</span><span style=color:#75715e>框</span>
            }
        }).disposed(by: disposeBag)
        
        <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>弹</span><span style=color:#75715e>窗</span><span style=color:#75715e>广</span><span style=color:#75715e>告</span><span style=color:#75715e>优</span><span style=color:#75715e>先</span><span style=color:#75715e>级</span><span style=color:#75715e>次</span><span style=color:#75715e>于</span><span style=color:#75715e>升</span><span style=color:#75715e>级</span><span style=color:#75715e>提</span><span style=color:#75715e>示</span><span style=color:#75715e>和</span><span style=color:#75715e>切</span><span style=color:#75715e>换</span><span style=color:#75715e>城</span><span style=color:#75715e>市</span>
        popAdvertise.subscribe(onNext: { status <span style=color:#66d9ef>in</span>
            <span style=color:#66d9ef>guard</span> <span style=color:#66d9ef>self</span>.upgrade.value <span style=color:#f92672>!=</span> .need, <span style=color:#66d9ef>self</span>.switchCity.value <span style=color:#f92672>!=</span> .need <span style=color:#66d9ef>else</span> {
                <span style=color:#66d9ef>return</span>
            }
            
            <span style=color:#66d9ef>if</span> status == .need {
                NotificationCenter.<span style=color:#66d9ef>default</span>.post(name: NSNotification.Name.Event.showPopAdvertise, object: <span style=color:#66d9ef>nil</span>)
            }
        }).disposed(by: disposeBag)
        
        <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>推</span><span style=color:#75715e>送</span><span style=color:#75715e>跳</span><span style=color:#75715e>转</span><span style=color:#75715e>优</span><span style=color:#75715e>先</span><span style=color:#75715e>级</span><span style=color:#75715e>在</span><span style=color:#75715e>这</span><span style=color:#75715e>个</span><span style=color:#75715e>例</span><span style=color:#75715e>子</span><span style=color:#75715e>里</span><span style=color:#75715e>排</span><span style=color:#75715e>最</span><span style=color:#75715e>后</span>
        apns.subscribe(onNext: { status <span style=color:#66d9ef>in</span>
            <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>当</span><span style=color:#75715e>需</span><span style=color:#75715e>要</span><span style=color:#75715e>考</span><span style=color:#75715e>虑</span><span style=color:#75715e>优</span><span style=color:#75715e>先</span><span style=color:#75715e>级</span><span style=color:#75715e>的</span><span style=color:#75715e>任</span><span style=color:#75715e>务</span><span style=color:#75715e>非</span><span style=color:#75715e>常</span><span style=color:#75715e>多</span><span style=color:#75715e>时</span><span style=color:#75715e>，</span><span style=color:#75715e>下</span><span style=color:#75715e>面</span><span style=color:#75715e>的</span><span style=color:#75715e> </span><span style=color:#75715e>g</span><span style=color:#75715e>u</span><span style=color:#75715e>a</span><span style=color:#75715e>r</span><span style=color:#75715e>d</span><span style=color:#75715e> </span><span style=color:#75715e>语</span><span style=color:#75715e>句</span><span style=color:#75715e>就</span><span style=color:#75715e>会</span><span style=color:#75715e>显</span><span style=color:#75715e>得</span><span style=color:#75715e>比</span><span style=color:#75715e>较</span><span style=color:#75715e>难</span><span style=color:#75715e>看</span><span style=color:#75715e>，</span><span style=color:#75715e>并</span><span style=color:#75715e>且</span><span style=color:#75715e>其</span><span style=color:#75715e>他</span><span style=color:#75715e>任</span><span style=color:#75715e>务</span><span style=color:#75715e>的</span><span style=color:#75715e>处</span><span style=color:#75715e>理</span><span style=color:#75715e>方</span><span style=color:#75715e>式</span><span style=color:#75715e>也</span><span style=color:#75715e>会</span><span style=color:#75715e>变</span><span style=color:#75715e>得</span><span style=color:#75715e>复</span><span style=color:#75715e>杂</span><span style=color:#75715e>，</span><span style=color:#75715e>所</span><span style=color:#75715e>以</span><span style=color:#75715e>目</span><span style=color:#75715e>前</span><span style=color:#75715e>实</span><span style=color:#75715e>现</span><span style=color:#75715e>方</span><span style=color:#75715e>式</span><span style=color:#75715e>更</span><span style=color:#75715e>适</span><span style=color:#75715e>用</span><span style=color:#75715e>于</span><span style=color:#75715e>中</span><span style=color:#75715e>小</span><span style=color:#75715e>项</span><span style=color:#75715e>目</span>
            <span style=color:#66d9ef>guard</span> <span style=color:#66d9ef>self</span>.upgrade.value <span style=color:#f92672>!=</span> .need, <span style=color:#66d9ef>self</span>.switchCity.value <span style=color:#f92672>!=</span> .need, <span style=color:#66d9ef>self</span>.popAdvertise.value <span style=color:#f92672>!=</span> .need <span style=color:#66d9ef>else</span> {
                <span style=color:#66d9ef>return</span>
            }
            
            <span style=color:#66d9ef>if</span> status == .need {
                NotificationCenter.<span style=color:#66d9ef>default</span>.post(name: NSNotification.Name.Event.apns, object: <span style=color:#66d9ef>nil</span>)
            }
        }).disposed(by: disposeBag)
        
        <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>需</span><span style=color:#75715e>要</span><span style=color:#75715e>换</span><span style=color:#75715e>肤</span><span style=color:#75715e>时</span><span style=color:#75715e>直</span><span style=color:#75715e>接</span><span style=color:#75715e>通</span><span style=color:#75715e>知</span><span style=color:#75715e>相</span><span style=color:#75715e>关</span><span style=color:#75715e>服</span><span style=color:#75715e>务</span>
        skin.subscribe(onNext: { status <span style=color:#66d9ef>in</span>
            <span style=color:#66d9ef>if</span> status == .need {
                NotificationCenter.<span style=color:#66d9ef>default</span>.post(name: NSNotification.Name.Event.skin, object: <span style=color:#66d9ef>nil</span>)
            }
        }).disposed(by: disposeBag)
        
        <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>需</span><span style=color:#75715e>要</span><span style=color:#75715e>展</span><span style=color:#75715e>示</span><span style=color:#75715e>小</span><span style=color:#75715e>红</span><span style=color:#75715e>点</span><span style=color:#75715e>提</span><span style=color:#75715e>醒</span><span style=color:#75715e>时</span><span style=color:#75715e>直</span><span style=color:#75715e>接</span><span style=color:#75715e>通</span><span style=color:#75715e>知</span><span style=color:#75715e>相</span><span style=color:#75715e>关</span><span style=color:#75715e>服</span><span style=color:#75715e>务</span>
        trackPoint.subscribe(onNext: { status <span style=color:#66d9ef>in</span>
            <span style=color:#66d9ef>if</span> status == .need {
                NotificationCenter.<span style=color:#66d9ef>default</span>.post(name: NSNotification.Name.Event.trackPoint, object: <span style=color:#66d9ef>nil</span>)
            }
        }).disposed(by: disposeBag)
        
        <span style=color:#75715e>//</span><span style=color:#75715e> </span><span style=color:#75715e>需</span><span style=color:#75715e>要</span><span style=color:#75715e>展</span><span style=color:#75715e>示</span><span style=color:#75715e>过</span><span style=color:#75715e>期</span><span style=color:#75715e>提</span><span style=color:#75715e>醒</span><span style=color:#75715e>时</span><span style=color:#75715e>直</span><span style=color:#75715e>接</span><span style=color:#75715e>通</span><span style=color:#75715e>知</span><span style=color:#75715e>相</span><span style=color:#75715e>关</span><span style=color:#75715e>服</span><span style=color:#75715e>务</span>
        remind.subscribe(onNext: { status <span style=color:#66d9ef>in</span>
            <span style=color:#66d9ef>if</span> status == .need {
                NotificationCenter.<span style=color:#66d9ef>default</span>.post(name: NSNotification.Name.Event.remind, object: <span style=color:#66d9ef>nil</span>)
            }
        }).disposed(by: disposeBag)
    }
}
</code></pre></div><p>上面介绍的方案应该能够满足大部分 app 的需求，如果你的 app 在使用组件化的同时业务也超鸡儿复杂，有很多需要考虑优先级的任务，则需要另外考虑实现方案或者对上面方案进行扩展，比如在 Task 中增加一个队列，用于存储当前需要执行的所有任务，并且任务可根据设置的优先级调整其在队列中的顺序，并支持挂起、执行中、已完成等状态，就像 NSOperationQueue 那样。。。</p></div><div class=post-footer></div></article></main></body></html>