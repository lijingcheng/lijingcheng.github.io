<!doctype html><html lang=zh-cn><head><title>App 埋点 SDK 设计 // 风行's Blog</title><meta charset=utf-8><meta name=generator content="Hugo 0.61.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="风行"><meta name=description content><link rel=stylesheet href=https://lijingcheng.github.io/css/main.min.61bb32028587f24ca28522d8d197970c7ef33284e5fffb45a75fcbbb2dbc4dcb.css><meta name=twitter:card content="summary"><meta name=twitter:title content="App 埋点 SDK 设计"><meta name=twitter:description content="适用平台 iOS / Android / HarmonyOS（可扩展至 Web、小程序）
事件采集 Tracker 自动采集   页面曝光，每次露出都触发，支持设置业务参数，页面停留时长，后端根据前端发送的页面曝光时间和后台停留时间计算，页面来源（a-b-c，c-b，b 的来源是 c）
  登录/退出，不发送事件，只修改本地存储的 userId
  App 生命周期（冷启动/热启动/退后台（杀掉），上滑并杀掉 app 会先走“退后台”回调方法，可在这里统计退出事件
  按钮/图片/Cell 点击事件
  手动采集   视图曝光（SDK 提供支持，然后根据需求手动去埋），支持 Banner轮播图/List列表 Item 曝光，曝光比例暂不考虑
  常规业务埋点
  数据处理 DataBuffer 数据内容 基础数据   基础属性（设备/版本/渠道/时间戳(客户端时间)/事件ID和类型/sessionId等），事件ID和sessionId 用于对埋点数据排序，需要在冷启动和切换用户时更新，退到后台达到指定时间再返回到 app 时也需要更新（app和小程序用5分钟，web用30分钟）
  用户属性（匿名ID/用户ID），匿名ID用 UUID + KeyChain 实现，不同端实现方式相似
  埋点平台ID，冷启动和登录后调接口拿，和匿名ID一起存在 Keychain
  业务数据   公共属性（城市/影院）"><meta property="og:title" content="App 埋点 SDK 设计"><meta property="og:description" content="适用平台 iOS / Android / HarmonyOS（可扩展至 Web、小程序）
事件采集 Tracker 自动采集   页面曝光，每次露出都触发，支持设置业务参数，页面停留时长，后端根据前端发送的页面曝光时间和后台停留时间计算，页面来源（a-b-c，c-b，b 的来源是 c）
  登录/退出，不发送事件，只修改本地存储的 userId
  App 生命周期（冷启动/热启动/退后台（杀掉），上滑并杀掉 app 会先走“退后台”回调方法，可在这里统计退出事件
  按钮/图片/Cell 点击事件
  手动采集   视图曝光（SDK 提供支持，然后根据需求手动去埋），支持 Banner轮播图/List列表 Item 曝光，曝光比例暂不考虑
  常规业务埋点
  数据处理 DataBuffer 数据内容 基础数据   基础属性（设备/版本/渠道/时间戳(客户端时间)/事件ID和类型/sessionId等），事件ID和sessionId 用于对埋点数据排序，需要在冷启动和切换用户时更新，退到后台达到指定时间再返回到 app 时也需要更新（app和小程序用5分钟，web用30分钟）
  用户属性（匿名ID/用户ID），匿名ID用 UUID + KeyChain 实现，不同端实现方式相似
  埋点平台ID，冷启动和登录后调接口拿，和匿名ID一起存在 Keychain
  业务数据   公共属性（城市/影院）"><meta property="og:type" content="article"><meta property="og:url" content="https://lijingcheng.github.io/posts/analyticssdk/"><meta property="article:published_time" content="2025-08-20T18:01:23+08:00"><meta property="article:modified_time" content="2025-08-20T18:01:23+08:00"></head><body><header class=app-header><a href=https://lijingcheng.github.io><img class=app-header-avatar src=/images/avatar.png alt=风行></a><h1>风行's Blog</h1><p>Do not repeat yourself!</p><div class=app-header-social><a target=_blank href=https://github.com/lijingcheng rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://www.instagram.com/bj_lijingcheng/ rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-instagram"><title>instagram</title><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>App 埋点 SDK 设计</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Aug 20, 2025</div></div></header><div class=post-content><p>适用平台 iOS / Android / HarmonyOS（可扩展至 Web、小程序）</p><h2 id=-tracker>事件采集 Tracker</h2><h3 id=heading>自动采集</h3><ul><li><p>页面曝光，每次露出都触发，支持设置业务参数，页面停留时长，后端根据前端发送的页面曝光时间和后台停留时间计算，页面来源（a-b-c，c-b，b 的来源是 c）</p></li><li><p>登录/退出，不发送事件，只修改本地存储的 userId</p></li><li><p>App 生命周期（冷启动/热启动/退后台（杀掉），上滑并杀掉 app 会先走“退后台”回调方法，可在这里统计退出事件</p></li><li><p>按钮/图片/Cell 点击事件</p></li></ul><h3 id=heading-1>手动采集</h3><ul><li><p>视图曝光（SDK 提供支持，然后根据需求手动去埋），支持 Banner轮播图/List列表 Item 曝光，曝光比例暂不考虑</p></li><li><p>常规业务埋点</p></li></ul><h2 id=-databuffer>数据处理 DataBuffer</h2><h3 id=heading-2>数据内容</h3><h4 id=heading-3>基础数据</h4><ul><li><p>基础属性（设备/版本/渠道/时间戳(客户端时间)/事件ID和类型/sessionId等），事件ID和sessionId 用于对埋点数据排序，需要在冷启动和切换用户时更新，退到后台达到指定时间再返回到 app 时也需要更新（app和小程序用5分钟，web用30分钟）</p></li><li><p>用户属性（匿名ID/用户ID），匿名ID用 UUID + KeyChain 实现，不同端实现方式相似</p></li><li><p>埋点平台ID，冷启动和登录后调接口拿，和匿名ID一起存在 Keychain</p></li></ul><h4 id=heading-4>业务数据</h4><ul><li><p>公共属性（城市/影院）</p></li><li><p>业务属性（movieId/movieName），类型支持数字和字符串</p></li></ul><h4 id=h5->H5 埋点数据</h4><ul><li>App 内嵌 H5 的事件，由 App 来发（基础数据由 App 获取，H5 发送业务属性）</li></ul><h3 id=heading-5>数据缓存</h3><ul><li><p>内存缓存（Queue）</p></li><li><p>本地缓存（SQLite 加密存储），冷启动时检查，删除 30 天前的数据（事务）</p></li><li><p>数据转移规则（50条/15秒/退后台(被杀)），防止数据因崩溃或断网丢失，避免内存暴涨和频繁读写文件，以及保障数据完整性，转移过程：专有Queue/异步/事务</p></li></ul><h2 id=-uploader>上报 Uploader</h2><ul><li><p>上报频率控制（冷启动、定时发送（默认 15 秒）、条数触发（默认 100 条））</p></li><li><p>数据压缩（GZIP）</p></li><li><p>数据加密（AES）</p></li><li><p>数据格式（Protobuf）</p></li><li><p>上传流量控制（WIFI/5G）</p></li></ul><h2 id=-config>全局配置 Config</h2><ul><li><p>API 远端控制（采集开关（API 按渠道控制开关）/每次上报数量/上传间隔/sessionId 更新时间），忽略接口返回的无效数据，0，“”</p></li><li><p>App 本地控制（是否输出日志/视图曝光比例/要忽略的页面（无意义的容器页面）等）</p></li></ul><h2 id=heading-6>日志与调试</h2><ul><li><p>支持在 IDE 输出日志（SDK初始化结果/埋点数据记录/上报结果等），线上关掉</p></li><li><p>QA 环境支持抓包</p></li></ul><h2 id=heading-7>其它</h2><ul><li><p>隐私合规方面需要产品去修改相关文档，说明采集数据用途</p></li><li><p>异常隔离，埋点功能出问题不能影响到 App 使用</p></li></ul><h2 id=heading-8>导图版</h2><p><img src=/images/analytics.png alt="App 埋点 SDK 设计思维导图" title="App 埋点 SDK 设计思维导图"></p></div><div class=post-footer></div></article></main></body></html>