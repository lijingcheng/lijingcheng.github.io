<!doctype html><html lang=zh-cn><head><title>Swift XCFramework 静态库 // 风行's Blog</title><meta charset=utf-8><meta name=generator content="Hugo 0.61.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="风行"><meta name=description content><link rel=stylesheet href=https://lijingcheng.github.io/css/main.min.61bb32028587f24ca28522d8d197970c7ef33284e5fffb45a75fcbbb2dbc4dcb.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Swift XCFramework 静态库"><meta name=twitter:description content="本文不讨论静态库和动态库区别，只记录使用 Xcode15 创建开发 XCFramework 静态库及使用方式
  新建 Framework 工程，为了方便测试，需要勾选 “Include Tests”
  打开 Edit Scheme，将 Run 下面的 Build Configuration 设置为 Release
  选中 Target 点击 General，修改 Minimum Deployments
  选中 Target 点击 Build Settings，Mach-O Type 选择 Static Library
  静态库需要暴露给别的项目使用的类和方法使用 public 修饰，需要被继承重写的类用 open 修饰，如果有图片等资源文件，可以存放在 Bundle 中，通过下面代码来引用
if let url = Bundle(for: Self.self).url(forResource: &#34;BundleName&#34;, withExtension: &#34;bundle&#34;), let bundle = Bundle(url: url) { if let path = bundle."><meta property="og:title" content="Swift XCFramework 静态库"><meta property="og:description" content="本文不讨论静态库和动态库区别，只记录使用 Xcode15 创建开发 XCFramework 静态库及使用方式
  新建 Framework 工程，为了方便测试，需要勾选 “Include Tests”
  打开 Edit Scheme，将 Run 下面的 Build Configuration 设置为 Release
  选中 Target 点击 General，修改 Minimum Deployments
  选中 Target 点击 Build Settings，Mach-O Type 选择 Static Library
  静态库需要暴露给别的项目使用的类和方法使用 public 修饰，需要被继承重写的类用 open 修饰，如果有图片等资源文件，可以存放在 Bundle 中，通过下面代码来引用
if let url = Bundle(for: Self.self).url(forResource: &#34;BundleName&#34;, withExtension: &#34;bundle&#34;), let bundle = Bundle(url: url) { if let path = bundle."><meta property="og:type" content="article"><meta property="og:url" content="https://lijingcheng.github.io/posts/xcframework/"><meta property="article:published_time" content="2024-06-07T09:49:45+08:00"><meta property="article:modified_time" content="2024-06-07T09:49:45+08:00"></head><body><header class=app-header><a href=https://lijingcheng.github.io><img class=app-header-avatar src=/images/avatar.png alt=风行></a><h1>风行's Blog</h1><p>Do not repeat yourself!</p><div class=app-header-social><a target=_blank href=https://github.com/lijingcheng rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://www.instagram.com/bj_lijingcheng/ rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-instagram"><title>instagram</title><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Swift XCFramework 静态库</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Jun 7, 2024</div></div></header><div class=post-content><p>本文不讨论静态库和动态库区别，只记录使用 Xcode15 创建开发 XCFramework 静态库及使用方式</p><ul><li><p>新建 Framework 工程，为了方便测试，需要勾选 “Include Tests”</p></li><li><p>打开 Edit Scheme，将 Run 下面的 Build Configuration 设置为 Release</p></li><li><p>选中 Target 点击 General，修改 Minimum Deployments</p></li><li><p>选中 Target 点击 Build Settings，Mach-O Type 选择 Static Library</p></li></ul><p>静态库需要暴露给别的项目使用的类和方法使用 public 修饰，需要被继承重写的类用 open 修饰，如果有图片等资源文件，可以存放在 Bundle 中，通过下面代码来引用</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> url = Bundle(<span style=color:#66d9ef>for</span>: <span style=color:#66d9ef>Self</span>.<span style=color:#66d9ef>self</span>).url(forResource: <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>BundleName</span><span style=color:#e6db74>&#34;</span>, withExtension: <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>bundle</span><span style=color:#e6db74>&#34;</span>), <span style=color:#66d9ef>let</span> bundle = Bundle(url: url) {
    <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> path = bundle.path(forResource: <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>fileName</span><span style=color:#e6db74>&#34;</span>, ofType: <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>txt</span><span style=color:#e6db74>&#34;</span>) {
        ...
    }
}
</code></pre></div><p>静态库项目设置好，并且代码也开发完成后，就可以生成 XCFramework 文件了，新建用于打包的 Target，在 Other 栏里选择 Aggregate，并做下面设置</p><ul><li><p>Edit Scheme，将 Build Configuration 设置为 Release</p></li><li><p>Build Settings 中的 User Script Sandboxing 选择 NO，Build Libraries for Distribution 选择 YES</p></li><li><p>Build Phases 新建 Run Script，并添加用于制作 Universal XCFramework 的脚本</p></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>SCHEME_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>PROJECT_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
FRAMEWORK_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>SCHEME_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
SIMULATOR_ARCHIVE_PATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>BUILD_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>CONFIGURATION<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>FRAMEWORK_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>-iphonesimulator.xcarchive</span><span style=color:#e6db74>&#34;</span>
DEVICE_ARCHIVE_PATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>BUILD_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>CONFIGURATION<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>FRAMEWORK_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>-iphoneos.xcarchive</span><span style=color:#e6db74>&#34;</span>
OUTPUT_DIC<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;./xcframework/&#34;</span>

<span style=color:#75715e># Simulator xcarchieve</span>
xcodebuild archive <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -scheme <span style=color:#e6db74>${</span>SCHEME_NAME<span style=color:#e6db74>}</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -archivePath <span style=color:#e6db74>${</span>SIMULATOR_ARCHIVE_PATH<span style=color:#e6db74>}</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -sdk iphonesimulator <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  SKIP_INSTALL<span style=color:#f92672>=</span>NO
  
<span style=color:#75715e># Device xcarchieve</span>
xcodebuild archive <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -scheme <span style=color:#e6db74>${</span>SCHEME_NAME<span style=color:#e6db74>}</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -archivePath <span style=color:#e6db74>${</span>DEVICE_ARCHIVE_PATH<span style=color:#e6db74>}</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -sdk iphoneos <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  SKIP_INSTALL<span style=color:#f92672>=</span>NO
  
<span style=color:#75715e># Clean up old output directory</span>
rm -rf <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>OUTPUT_DIC<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>

<span style=color:#75715e># Create xcframwork combine of all frameworks</span>
xcodebuild -create-xcframework <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -framework <span style=color:#e6db74>${</span>SIMULATOR_ARCHIVE_PATH<span style=color:#e6db74>}</span>/Products/Library/Frameworks/<span style=color:#e6db74>${</span>FRAMEWORK_NAME<span style=color:#e6db74>}</span>.framework <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -framework <span style=color:#e6db74>${</span>DEVICE_ARCHIVE_PATH<span style=color:#e6db74>}</span>/Products/Library/Frameworks/<span style=color:#e6db74>${</span>FRAMEWORK_NAME<span style=color:#e6db74>}</span>.framework <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -output <span style=color:#e6db74>${</span>OUTPUT_DIC<span style=color:#e6db74>}</span>/<span style=color:#e6db74>${</span>FRAMEWORK_NAME<span style=color:#e6db74>}</span>.xcframework
</code></pre></div><p>XCFramework 文件可以放到私有库中，并以 CocoaPods 方式集成到项目中进行联调，podspec 文件如下</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#66d9ef>Pod</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Spec</span><span style=color:#f92672>.</span>new <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>s<span style=color:#f92672>|</span>
s<span style=color:#f92672>.</span>name         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;XXX&#39;</span>
s<span style=color:#f92672>.</span>version      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;1.0.0&#39;</span>
s<span style=color:#f92672>.</span>author       <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;...&#39;</span>
s<span style=color:#f92672>.</span>license      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;MIT&#39;</span>
s<span style=color:#f92672>.</span>homepage     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;...&#39;</span>
s<span style=color:#f92672>.</span>source       <span style=color:#f92672>=</span> { <span style=color:#e6db74>:git</span> <span style=color:#f92672>=</span><span style=color:#f92672>&gt;</span><span style=color:#e6db74>&#39;...&#39;</span>, <span style=color:#e6db74>:branch</span> <span style=color:#f92672>=</span><span style=color:#f92672>&gt;</span> <span style=color:#e6db74>&#39;master&#39;</span>, <span style=color:#e6db74>:tag</span> <span style=color:#f92672>=</span><span style=color:#f92672>&gt;</span> s<span style=color:#f92672>.</span>version}
s<span style=color:#f92672>.</span>summary      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;...&#39;</span>
s<span style=color:#f92672>.</span>platform     <span style=color:#f92672>=</span> <span style=color:#e6db74>:ios</span>, <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>12.0</span><span style=color:#e6db74>&#34;</span>
s<span style=color:#f92672>.</span>resource     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;XX.bundle&#39;</span>
s<span style=color:#f92672>.</span>vendored_frameworks <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>XX.xcframework</span><span style=color:#e6db74>&#34;</span>
s<span style=color:#f92672>.</span>pod_target_xcconfig <span style=color:#f92672>=</span> {
  <span style=color:#e6db74>&#39;DEFINES_MODULE&#39;</span> <span style=color:#f92672>=</span><span style=color:#f92672>&gt;</span> <span style=color:#e6db74>&#39;YES&#39;</span>,
  <span style=color:#e6db74>&#39;CLANG_ALLOW_NON_MODULAR_INCLUDES_IN_FRAMEWORK_MODULES&#39;</span> <span style=color:#f92672>=</span><span style=color:#f92672>&gt;</span> <span style=color:#e6db74>&#39;YES&#39;</span>
}
<span style=color:#66d9ef>end</span>
</code></pre></div><p>可以在联调结束后再确定版本号，联调期间不修改版本号的话，项目在 pod install 前需要清除缓存</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>pod cache clean <span style=color:#66d9ef>XCFrameworkName</span> <span style=color:#f92672>-</span><span style=color:#f92672>-</span>all
rm <span style=color:#f92672>-</span>rf <span style=color:#66d9ef>Pods</span><span style=color:#f92672>/</span><span style=color:#66d9ef>XCFrameworkName</span>
</code></pre></div></div><div class=post-footer></div></article></main></body></html>