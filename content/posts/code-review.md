---
title: "Code Review"
date: 2019-12-30T17:00:38+08:00
draft: true
---

持续并有效的 Code Review 不仅可以提高代码质量，降低程序风险，还可以提高开发人员技术水平，但前提是需要开发人员能够真正认可并意识到这并不是在浪费时间，而且在实施前最好能够得到公司认可，并能够将 Code Review 时间计入工作量，下面列出几条需要注意的地方：

- 要有一个 CheckList，对一些代码问题进行定义，要求开发人员以此为准

- 最好是在代码提交测试前做，避免测试人员返工，影响进度

- 审查要及时，打回时被审查者要尽量优先修改问题然后再次提交

- 审查不通过打回前，条件允许的话最好先跟代码提交者口头说明原因并达成一致

- Review 过程中不要太关注代码细节，并且不要过度主观，例如同一功能可用多种方式实现并且它们之间没有明显好坏的情况下不用要求别人修改代码

- 按功能提交代码，不要攒一堆然后一次提交，否则不仅会一次性大量占用审查者时间，而且还会增加审查难度

- 提交描述要根据情况写清楚修改内容以及原因，并且加上前辍，如 fix: fea:

- 审查者与被审者都需要认真对待，以提高 Code Review 质量

代码评审的方式也需要注意，对于代码风格上的问题应该通过自动 Review 工具去做，如 OCLint/SwiftLint，对于代码逻辑及性能上的问题可通过 Merge Request 方式去做。

对于找谁审核这个问题，首先要明确责任，可以让同一套代码有两个人负责，这样的好处不仅能够明确责任，还可以在其中一方休长假或有突发事件相关人不在的情况下，另一人能够有能力修改相关代码，对于刚实行此制度的团队要给予时间过度。




好处
开发者知道自己的代码是要被人审查的，所以质量会有所提高。
审查时可以学习别人写代码的方式，被审查者也会知道自己的代码出了什么问题，技术上会有提高。

代码审查如果要做就一定要做好，并坚持下去，要不就没有意义了。

提高代码能力的方式
代码 Review
对自己提高要求
看别人的代码
看书
《代码整洁之道》
《重构—-改善既有代码的设计》

https://github.com/raywenderlich/swift-style-guide
https://github.com/realm/SwiftLint

# CheckList
- 代码简洁不重复

- 方法短小并专注一个功能

- 删除无用的代码及资源

- 适时地使用 private 实现封装并使代码更清晰

- 避免无意义的 log，保持好的编码习惯

- 不要用魔术数字

- 框架代码及复杂代码要写注释

- 遍历数组或字典时不允许添加或删除元素

- 代码尽量不要有警告

- 相似意义的常量超过 2 个时就要考虑用枚举代替

- 命名要做到“见名知意”，UI 控件的命名要能看出来是什么控件

- 方法内变量的声明尽量离使用它的地方近一些

- 使用 xib 或 storyboard 画界面来降低代码量，UI 控件可通过纯代码实现

- 尽量避免循环引用问题

- Model 中对应接口返回 Int 类型字段如果需要定义成枚举，需要注意接口返回未定义 case 的场景

- 避免对可选类型强解包，可用 `if let foo = foo { ... }` 或可选链 `foo?.doSomething()`

- 尽早的退出方法，可提升代码的可读性，例：`guard xx else { return }`或`if xxx { return} `，使用 guard 还能够有效减少 if-else 嵌套 

- 定义 model 用 struct，值类型是线程安全的，并以栈的形式分配，速度上比 class 快

- 用于对接接口返回数据的 model 中的属性必须是 optional 的，当接口返回字段较少时，可用字典

- 不要在 ViewModel 里用到跟 UIKit 相关的东西，Controller 当 View 用，尽量不写逻辑性代码

- UI 切的图需要[压缩](https://tinypng.com)后再使用，图片命名方式：
`icon_hud_loading@2x.png`

- 项目的主色和辅色有对应常量，如果在 xib 中使用，需要先将做好的 .clr 文件复制到指定目录

- 用`// MARK:`来做代码分段，用`// TODO:`来做待办，但需要写出计划完成时间或条件

- 尽量多用常量来增强代码的不可变性，可以让代码更加安全并提高可读性

- 尽量避免混合使用 Swift 类型和 NSObject 子类，这样会造成大量的类型转换，对性能有影响

