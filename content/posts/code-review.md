---
title: "Code Review"
date: 2020-01-07T10:00:38+08:00
draft: true
---

持续并有效的 Code Review 不仅可以提高代码质量，降低程序风险，还可以提高开发人员技术水平，但前提是需要开发人员能够真正认可并意识到这并不是在浪费时间，而且在实施前最好能够得到公司认可，并能够将 Code Review 时间计入工作量，下面列出几个需要注意的地方：

- 要有一个 CheckList，对一些代码问题进行定义，并要求开发人员以此为准，定义的问题可按级别分类，高级别的必须解决，低级别的根据具体情况处理

- 代码风格上的问题应该通过自动审查工具去做，如 [OCLint](https://github.com/oclint/oclint)/[SwiftLint](https://github.com/realm/SwiftLint)，代码逻辑及性能上的问题可通过 Merge Request 方式去做，整个团队一起互相 Review 的方式不适合频繁实行，应该以总结的性质定期来做

- 要在代码提交测试前做，避免测试人员返工，影响进度

- 审查过程中不要太关注代码细节，并且不要过度主观，例如同一功能可用多种方式实现并且它们之间没有明显好坏的情况下不用要求别人修改代码

- 审查要及时，打回时被审查者要尽量优先修改问题然后再次提交

- 审查不通过打回前，条件允许的话最好先跟代码提交者口头说明原因并达成一致，无法达成一致时可找 leader 解决

- 对于找谁审核代码这个问题，首先每份代码都要明确责任人，可以让同一套代码有两个人负责，这样不仅能够明确责任，还可以在其中一人休长假或有突发事件人不在的情况下，另一人能够有能力修改相关代码

代码提交规范在这里也需要重点说一下，首先要按功能提交代码，不要攒一堆然后一次提交，否则不仅会一次性大量占用审查者时间，而且会增加审查难度，还需要注意的是提交描述要根据情况写清楚修改内容以及原因，并且加上前辍，格式如：type(scope):subject



下面列出的提交规范，可根据团队情况选择工具强制执行并较验，也可以通过大家自觉遵守执行，然后用 git hook 方式检查。

本文介绍Angular 规范是目前使用最广的写法，比较合理和系统化，并且有配套的工具。

可以直接从commit生成Change log。



( 1 ) type（必须） : commit 的类别，只允许使用下面几个标识：

feat : 新功能
fix : 修复bug
docs : 文档改变
style : 代码格式改变
refactor : 某个已有功能重构
perf : 性能优化
test : 增加测试
build : 改变了build工具 如 grunt换成了 npm
revert : 撤销上一次的 commit
chore : 构建过程或辅助工具的变动
( 2 ) scope（可选） : 用于说明 commit 影响的范围，比如数据层、控制层、视图层等等，视项目不同而不同。影响非常多时可用 * 表示

( 3 ) subject（必须） : commit 的简短描述，不超过50个字符。
commitizen 是一个撰写合格 Commit message 的工具，
格式：type(scope):subject

feat(首页):增加通知公告功能

fix(卡列表):默认图不正确

docs(StringExt):修改方法注释

refactor(BannerView):修改轮播图切换规则

other(角本):pod install 之前清理缓存


下面列出的代码审查 CheckList 有一部分仅适用于 Swift 开发

- 代码简洁不重复

- 方法短小并专注一个功能

- 删除无用的代码及资源

- 适时地使用 private 实现封装并使代码更清晰

- 避免无意义的 log，保持好的编码习惯

- 不要用魔术数字

- 框架代码及复杂代码要写注释

- 遍历数组或字典时不允许添加或删除元素

- 代码尽量不要有警告

- 相似意义的常量超过 2 个时就要考虑用枚举代替

- 命名要做到“见名知意”，UI 控件的命名要能看出来是什么控件

- 方法内变量的声明尽量离使用它的地方近一些

- 使用 xib 或 storyboard 画界面来降低代码量，UI 控件可通过纯代码实现

- 尽量避免循环引用问题

- Model 中对应接口返回 Int 类型字段如果需要定义成枚举，需要注意接口返回未定义 case 的场景

- 避免对可选类型强解包，可用 `if let foo = foo { ... }` 或可选链 `foo?.doSomething()`

- 尽早的退出方法，可提升代码的可读性，例：`guard xx else { return }`或`if xxx { return} `，使用 guard 还能够有效减少 if-else 嵌套 

- 定义 model 用 struct，值类型是线程安全的，并以栈的形式分配，速度上比 class 快

- 用于对接接口返回数据的 model 中的属性必须是 optional 的，当接口返回字段较少时，可用字典

- 不要在 ViewModel 里用到跟 UIKit 相关的东西，Controller 当 View 用，尽量不写逻辑性代码

- UI 切的图需要[压缩](https://tinypng.com)后再使用，图片命名方式：
`icon_hud_loading@2x.png`

- 项目的主色和辅色有对应常量，如果在 xib 中使用，需要先将做好的 .clr 文件复制到指定目录

- 用 `// MARK:` 来做代码分段，用 `// TODO:` 来做待办，但需要写出计划完成时间或条件

- 尽量多用常量来增强代码的不可变性，可以让代码更加安全并提高可读性

- 尽量避免混合使用 Swift 类型和 NSObject 子类，这样会造成大量的类型转换，对性能有影响

代码审查如果要做就一定要做好，并坚持下去，半途而废的话之前的工作也就白做了，最后推荐 Ray Wenderlich 提供的 [Swift Style Guide](https://github.com/raywenderlich/swift-style-guide) 和《代码整洁之道》、《重构—改善既有代码的设计》这两本书。





